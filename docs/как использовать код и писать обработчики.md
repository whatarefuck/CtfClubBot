# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ö–µ–Ω–¥–ª–µ—Ä–∞–º–∏ –≤ Telegram-–±–æ—Ç–µ

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–Ω–æ–≤–æ–≥–æ-—Ö–µ–Ω–¥–ª–µ—Ä–∞)
  - [–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞](#–æ—Å–Ω–æ–≤–Ω–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ö–µ–Ω–¥–ª–µ—Ä–∞)
  - [–†–∞–±–æ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)](#—Ä–∞–±–æ—Ç–∞-—Å-—Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏-fsm)
  - [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
  - [–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#—Ä–∞–±–æ—Ç–∞-—Å-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
- [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-—Ö–µ–Ω–¥–ª–µ—Ä–∞-–∫-–ø—Ä–æ–µ–∫—Ç—É)
  - [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ `__init__.py`](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–≤-—Ñ–∞–π–ª–µ-__init__py)
  - [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≥–ª–∞–≤–Ω–æ–º—É —Ä–æ—É—Ç–µ—Ä—É](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–∫-–≥–ª–∞–≤–Ω–æ–º—É-—Ä–æ—É—Ç–µ—Ä—É)
- [–†–∞–±–æ—Ç–∞ —Å DAO –∫–ª–∞—Å—Å–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-dao-–∫–ª–∞—Å—Å–∞–º–∏)
  - [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ DAO –∫–ª–∞—Å—Å—ã](#—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ-dao-–∫–ª–∞—Å—Å—ã)
  - [–ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ DAO](#–ø—Ä–∏–Ω—Ü–∏–ø—ã-—Å–æ–∑–¥–∞–Ω–∏—è-–Ω–æ–≤—ã—Ö-–º–µ—Ç–æ–¥–æ–≤-–≤-dao)
  - [–ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DAO –º–µ—Ç–æ–¥–æ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Å–æ–∑–¥–∞–Ω–∏—è-–∏-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-dao-–º–µ—Ç–æ–¥–æ–≤)
- [–†–∞–±–æ—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#—Ä–∞–±–æ—Ç–∞-—Å-—Å–∏—Å—Ç–µ–º–æ–π-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
  - [–ö–ª–∞—Å—Å Notifications](#–∫–ª–∞—Å—Å-notifications)
  - [–ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#–ø—Ä–∏–Ω—Ü–∏–ø—ã-—Å–æ–∑–¥–∞–Ω–∏—è-–Ω–æ–≤—ã—Ö-–º–µ—Ç–æ–¥–æ–≤-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
  - [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-—Å–∏—Å—Ç–µ–º—ã-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
- [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)
  - [–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π](#–ø—Ä–∏–º–µ—Ä-–ø—Ä–æ—Å—Ç–æ–≥–æ-—Ö–µ–Ω–¥–ª–µ—Ä–∞-–±–µ–∑-—Å–æ—Å—Ç–æ—è–Ω–∏–π)
  - [–ü—Ä–∏–º–µ—Ä —Ö–µ–Ω–¥–ª–µ—Ä–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏](#–ø—Ä–∏–º–µ—Ä-—Ö–µ–Ω–¥–ª–µ—Ä–∞-—Å-—Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏)

## –í–≤–µ–¥–µ–Ω–∏–µ

–í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Aiogram 3.x –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞. –•–µ–Ω–¥–ª–µ—Ä—ã –≤ Aiogram 3.x - —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ—Ç–æ–º.

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –∏ –∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ä–æ—É—Ç–µ—Ä—É –±–æ—Ç–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```
bot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ start.py             # –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /start –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ exercise.py          # –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ competition.py       # –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py             # –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ deadlines.py         # –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ... (–¥—Ä—É–≥–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã)
‚îî‚îÄ‚îÄ main.py                  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞, –≥–¥–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã
```

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞

### –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞

–ö–∞–∂–¥—ã–π —Ö–µ–Ω–¥–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `bot/handlers/`. –í–æ—Ç –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞:

```python
from aiogram import Router, types
from aiogram.filters.command import Command

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞
my_new_router = Router()

# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /my_command
@my_new_router.message(Command("my_command"))
async def my_command_handler(message: types.Message):
    await message.reply("–û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É /my_command")
```

### –†–∞–±–æ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)

–î–ª—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FSM (Finite State Machine):

1. –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `bot/states/your_states.py`:

```python
from aiogram.fsm.state import State, StatesGroup

class MyNewForm(StatesGroup):
    first_step = State()
    second_step = State()
    final_step = State()
```

2. –ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ:

```python
from aiogram import Router, types
from aiogram.filters.command import Command
from aiogram.fsm.context import FSMContext
from states.your_states import MyNewForm

my_new_router = Router()

@my_new_router.message(Command("start_form"))
async def start_form(message: types.Message, state: FSMContext):
    await message.reply("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞:")
    await state.set_state(MyNewForm.first_step)

@my_new_router.message(MyNewForm.first_step)
async def process_first_step(message: types.Message, state: FSMContext):
    await state.update_data(first_step_data=message.text)
    await message.reply("–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —à–∞–≥–∞:")
    await state.set_state(MyNewForm.second_step)

@my_new_router.message(MyNewForm.second_step)
async def process_second_step(message: types.Message, state: FSMContext):
    await state.update_data(second_step_data=message.text)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    form_data = await state.get_data()
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    result = f"–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:\n1. {form_data['first_step_data']}\n2. {form_data['second_step_data']}"
    
    await message.reply(result)
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await state.clear()
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–±–æ–µ–≤ –±–æ—Ç–∞:

```python
from sqlalchemy.exc import IntegrityError

try:
    # –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É
    with get_db() as db:
        # –†–∞–±–æ—Ç–∞ —Å –ë–î...
    await message.reply("–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!")
except IntegrityError as e:
    await message.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.")
    # –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
    await state.clear()
except Exception as e:
    await message.reply(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {str(e)}")
    await state.clear()
```

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–í —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `get_db()` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ DAO (Data Access Objects):

```python
from database.db import get_db
from database.user_dao import UserDAO

@my_new_router.message(Command("user_info"))
async def get_user_info(message: types.Message):
    with get_db() as db:
        user_dao = UserDAO(db)
        user = user_dao.get_user_by_tg_id(message.from_user.id)
        
        if user:
            await message.reply(f"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:\n–ò–º—è: {user.full_name}\n–ë–∞–ª–ª—ã: {user.points}")
        else:
            await message.reply("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å –ø–æ–º–æ—â—å—é /start")
```

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Å —Ö–µ–Ω–¥–ª–µ—Ä–æ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ä–æ—É—Ç–µ—Ä—É –±–æ—Ç–∞.

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ `__init__.py`

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `bot/handlers/__init__.py`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∞—à –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ —ç–∫—Å–ø–æ—Ä—Ç:

```python
from .start import start_router
from .exercise import add_task_router
# ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã ...
from .your_new_handler import my_new_router  # –ò–º–ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ –Ω–æ–≤–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã
__all__ = [
    'start_router',
    'add_task_router',
    # ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    'my_new_router',  # –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—à –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä
]
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–æ–≤ –∫–∞–∫ –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

```python
from .start import start_router
from .exercise import add_task_router
# ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã ...
from .your_new_handler import my_new_router  # –ò–º–ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ –Ω–æ–≤–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≥–ª–∞–≤–Ω–æ–º—É —Ä–æ—É—Ç–µ—Ä—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `bot/main.py`
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é, –≥–¥–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Ä–æ—É—Ç–µ—Ä—ã, –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä:

```python
from handlers import (
    start_router,
    add_task_router,
    # ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    my_new_router,  # –î–æ–±–∞–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
)

# ...

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ
dp.include_routers(
    start_router,
    add_task_router,
    # ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    my_new_router,  # –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–∞—à —Ä–æ—É—Ç–µ—Ä
)
```

3. –¢–∞–∫–∂–µ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞:

```python
commands = [
    types.BotCommand(command='/start', description='–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞'),
    # ... –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã ...
    types.BotCommand(command='/my_command', description='–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–π –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã'),
]
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Ö–µ–Ω–¥–ª–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
2. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è —Ä–æ—É—Ç–µ—Ä–æ–≤, –æ—Ç—Ä–∞–∂–∞—é—â–∏–µ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞**: –î–æ–±–∞–≤–ª—è–π—Ç–µ docstrings –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
5. **–û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π**: –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ—á–∏—â–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—à–∏–±–∫–∏
6. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–∞–Ω–¥–∞–º (–∫–∞–∫ –≤ `AuthMiddleware`)

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```python
# bot/handlers/statistics.py
from aiogram import Router, types
from aiogram.filters.command import Command
from database.db import get_db
from database.user_dao import UserDAO

statistics_router = Router()

@statistics_router.message(Command("statistics"))
async def show_statistics(message: types.Message):
    with get_db() as db:
        user_dao = UserDAO(db)
        total_users = len(user_dao.get_all_students())
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats_text = f"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞:\n"\
                    f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
        
        await message.reply(stats_text)
```

–ó–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∞–µ–º –µ–≥–æ –≤ `__init__.py`:

```python
# bot/handlers/__init__.py
from .start import start_router
# ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã ...
from .statistics import statistics_router

# –≠–∫—Å–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–æ–≤
from .start import start_router
from .exercise import add_task_router
# ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
from .statistics import statistics_router
```

–ò –¥–æ–±–∞–≤–ª—è–µ–º –≤ `main.py`:

```python
# bot/main.py
from handlers import (
    start_router,
    # ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    statistics_router,
)

# ...

dp.include_routers(
    start_router,
    # ... –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    statistics_router,
)

commands = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã ...
    types.BotCommand(command='/statistics', description='–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞'),
]
```

### –ü—Ä–∏–º–µ—Ä —Ö–µ–Ω–¥–ª–µ—Ä–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

–°–æ–∑–¥–∞–¥–∏–º —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –æ –±–æ—Ç–µ:

```python
# bot/states/feedback_states.py
from aiogram.fsm.state import State, StatesGroup

class FeedbackForm(StatesGroup):
    rating = State()
    comment = State()
```

```python
# bot/handlers/feedback.py
from aiogram import Router, types
from aiogram.filters.command import Command
from aiogram.fsm.context import FSMContext
from datetime import datetime
from database.db import get_db
from states.feedback_states import FeedbackForm

feedback_router = Router()

@feedback_router.message(Command("feedback"))
async def start_feedback(message: types.Message, state: FSMContext):
    await message.reply(
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω–∏—Ç–µ –±–æ—Ç–∞ –æ—Ç 1 –¥–æ 5, –≥–¥–µ 5 - –æ—Ç–ª–∏—á–Ω–æ, 1 - –ø–ª–æ—Ö–æ:"
    )
    await state.set_state(FeedbackForm.rating)

@feedback_router.message(FeedbackForm.rating)
async def process_rating(message: types.Message, state: FSMContext):
    try:
        rating = int(message.text)
        if 1 <= rating <= 5:
            await state.update_data(rating=rating)
            await message.reply("–°–ø–∞—Å–∏–±–æ! –¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏–µ:")
            await state.set_state(FeedbackForm.comment)
        else:
            await message.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5.")
    except ValueError:
        await message.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5.")

@feedback_router.message(FeedbackForm.comment)
async def process_comment(message: types.Message, state: FSMContext):
    await state.update_data(comment=message.text)
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    feedback_data = await state.get_data()
    rating = feedback_data["rating"]
    comment = feedback_data["comment"]
    
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –≤ –ë–î
    
    await message.reply(
        f"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤!\n"
        f"–û—Ü–µ–Ω–∫–∞: {'‚≠ê' * rating}\n"
        f"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {comment}"
    )
    
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await state.clear()
```

–ü–æ–¥–∫–ª—é—á–∞–µ–º –≤ `__init__.py`:

```python
# bot/handlers/__init__.py
# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–ø–æ—Ä—Ç—ã ...
from .feedback import feedback_router

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–∫—Å–ø–æ—Ä—Ç—ã ...
from .feedback import feedback_router
```

–ò –≤ `main.py`:

```python
# bot/main.py
from handlers import (
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    feedback_router,
)

# ...

dp.include_routers(
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç–µ—Ä—ã ...
    feedback_router,
)

commands = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã ...
    types.BotCommand(command='/feedback', description='–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –æ –±–æ—Ç–µ'),
]
```

## –†–∞–±–æ—Ç–∞ —Å DAO –∫–ª–∞—Å—Å–∞–º–∏

DAO (Data Access Object) –∫–ª–∞—Å—Å—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞. –ö–∞–∂–¥—ã–π DAO –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–±–æ—Ç—É —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö.

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ DAO –∫–ª–∞—Å—Å—ã

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ DAO –∫–ª–∞—Å—Å—ã:

1. **UserDAO** (`bot/database/user_dao.py`) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é User
2. **TaskDao** (`bot/database/task_dao.py`) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é Task
3. **CompetitionDao** (`bot/database/competition_dao.py`) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é Competition

–ö–∞–∂–¥—ã–π DAO –∫–ª–∞—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º —Å–µ—Å—Å–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```python
class UserDAO:
    def __init__(self, session):
        self.session = session
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ DAO

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ DAO –∫–ª–∞—Å—Å–∞—Ö —Å–ª–µ–¥—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

1. **–û–¥–∏–Ω –º–µ—Ç–æ–¥ - –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è**: –ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ª–æ–≥–∏—á–µ—Å–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
2. **–°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤
3. **–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –º–µ—Ç–æ–¥–æ–≤**: –ò–º—è –º–µ—Ç–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—é (get_*, create_*, update_*, delete_*)
4. **–ü–æ–¥—Ä–æ–±–Ω—ã–µ docstrings**: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥, –æ–ø–∏—Å—ã–≤–∞—è –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
5. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**: DAO –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫—É –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º, –∞ –Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –ï—Å–ª–∏ –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DAO –º–µ—Ç–æ–¥–æ–≤

#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ UserDAO

```python
from database.models import User
from typing import List, Optional

class UserDAO:
    def __init__(self, session):
        self.session = session
    
    def get_active_users(self, min_points: int = 0) -> List[User]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–∞–ª–ª–æ–≤ –≤—ã—à–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ.
        
        :param min_points: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
        :return: –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        """
        return (
            self.session.query(User)
            .filter(User.points >= min_points)
            .order_by(User.points.desc())
            .all()
        )
    
    def update_user_points(self, user_id: int, points_delta: int) -> Optional[User]:
        """–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        
        :param user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        :param points_delta: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–ª–ª–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
        :return: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ None, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
        """
        user = self.session.query(User).filter(User.id == user_id).first()
        if not user:
            return None
            
        user.points += points_delta
        self.session.commit()
        self.session.refresh(user)
        return user
```

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DAO –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ

```python
from aiogram import Router, types
from aiogram.filters.command import Command
from database.db import get_db
from database.user_dao import UserDAO

points_router = Router()

@points_router.message(Command("add_points"))
async def add_points_handler(message: types.Message):
    # –†–∞–∑–±–∏—Ä–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã: /add_points username 50
    args = message.text.split()
    if len(args) != 3:
        await message.reply("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /add_points username –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ")
        return
    
    username = args[1]
    try:
        points = int(args[2])
    except ValueError:
        await message.reply("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º")
        return
    
    with get_db() as db:
        user_dao = UserDAO(db)
        user_id = user_dao.get_user_id_by_username(username)
        
        if not user_id:
            await message.reply(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return
            
        updated_user = user_dao.update_user_points(user_id, points)
        
        await message.reply(
            f"–ë–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @{username} –æ–±–Ω–æ–≤–ª–µ–Ω—ã.\n"
            f"–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤: {updated_user.points}"
        )
```

## –†–∞–±–æ—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ö–ª–∞—Å—Å Notifications

–ö–ª–∞—Å—Å `Notifications` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞. –û–Ω –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å API Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

```python
from aiogram import Bot
from database.db import get_db
from bot.database.user_dao import UserDAO
from database.models import User
from logging import getLogger

logger = getLogger(__name__)

class Notifications:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    def __init__(self, bot: Bot):
        self.bot = bot

    async def _say_all_students(self, message: str):
        """–£–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ —á–µ–º-—Ç–æ.

        :param message: –ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
        """
        with get_db() as session:
            user_dao = UserDAO(session)
            students = user_dao.get_all_students()
            for student in students:
                await self.bot.send_message(chat_id=student.tg_id, text=message)
                logger.info(f"Sent {message} to {student.full_name} - @{student.username}")

    async def _say_teachers(self, message: str):
        """–£–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ—Ö —É—á–∏—Ç–µ–ª–µ–π –æ —á–µ–º-—Ç–æ.

        :param message: –ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
        """
        with get_db() as session:
            user_dao = UserDAO(session)
            teachers = user_dao.get_teachers()
            for teacher in teachers:
                await self.bot.send_message(chat_id=teacher.tg_id, text=message)
                logger.info(f"Sent {message} to {teacher.full_name} - @{teacher.username}")

    async def _say_student(self, student: User, message: str):
        """–ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—É –æ —á–µ–º-—Ç–æ."""
        await self.bot.send_message(chat_id=student.tg_id, text=message)
        logger.info(f"Sent {message} to {student.full_name} - @{student.username}")
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ –∫–ª–∞—Å—Å–µ `Notifications` —Å–ª–µ–¥—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

1. **–ü–æ–ª–µ–∑–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `_`) –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
2. **–ê–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏**: –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `_` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –í—Å–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `async/await`)
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–ª–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞
5. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –º–∞—Å—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –î–æ–±–∞–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```python
class Notifications:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã ...
    
    async def notify_new_task(self, task_name: str, task_description: str, deadline: str):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ.
        
        :param task_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        :param task_description: –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        :param deadline: –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        """
        message = (
            f"üìù –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞!\n\n"
            f"–ù–∞–∑–≤–∞–Ω–∏–µ: {task_name}\n"
            f"–û–ø–∏—Å–∞–Ω–∏–µ: {task_description}\n"
            f"–°—Ä–æ–∫: {deadline}\n\n"
            f"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞—á–∏: /my_tasks"
        )
        
        try:
            await self._say_all_students(message)
            logger.info(f"Notification about new task '{task_name}' sent to all students")
        except Exception as e:
            logger.error(f"Failed to send notification about new task: {e}")
    
    async def notify_deadline_approaching(self, student: User, task_name: str, days_left: int):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–µ–º—Å—è –¥–µ–¥–ª–∞–π–Ω–µ.
        
        :param student: –û–±—ä–µ–∫—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞
        :param task_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        :param days_left: –î–Ω–µ–π –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
        """
        message = (
            f"‚ö†Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –¥–µ–¥–ª–∞–π–Ω–µ!\n\n"
            f"–ó–∞–¥–∞—á–∞: {task_name}\n"
            f"–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: {days_left}\n\n"
            f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –≤–æ–≤—Ä–µ–º—è."
        )
        
        try:
            await self._say_student(student, message)
            logger.info(f"Deadline reminder for '{task_name}' sent to {student.username}")
        except Exception as e:
            logger.error(f"Failed to send deadline reminder to {student.username}: {e}")
```

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ Notifications –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ

```python
from aiogram import Router, types
from aiogram.filters.command import Command
from services.notifications import Notifications

notifications_router = Router()

@notifications_router.message(Command("notify_all"))
async def notify_all_handler(message: types.Message, bot: Bot):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–º–∞–Ω–¥—É –≤—ã–∑–≤–∞–ª –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
    if not is_teacher(message.from_user.id):
        await message.reply("–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã")
        return
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤—Å–µ –ø–æ—Å–ª–µ /notify_all)
    notification_text = message.text.replace("/notify_all", "").strip()
    if not notification_text:
        await message.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã")
        return
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    notifications = Notifications(bot)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º
    await notifications._say_all_students(notification_text)
    
    await message.reply("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º")
```

–í —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Ç–∞–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –Ω–æ –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

---
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫ –∏–∑—É—á–µ–Ω–∏—é:
https://docs.aiogram.dev/en/latest/
https://mastergroosha.github.io/aiogram-3-guide/quickstart/